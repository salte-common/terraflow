# AWS Example: S3 Backend + Secrets Manager
# This example shows a complete AWS setup with S3 backend for state storage
# and AWS Secrets Manager for secrets management.

backend:
  type: s3
  config:
    # Use template variables for dynamic bucket naming
    bucket: ${AWS_REGION}-${AWS_ACCOUNT_ID}-terraform-state
    key: ${GITHUB_REPOSITORY}/terraform.tfstate
    region: ${AWS_REGION}
    
    # Security settings
    encrypt: true
    dynamodb_table: terraform-statelock
    
    # Optional: KMS encryption
    # kms_key_id: arn:aws:kms:${AWS_REGION}:${AWS_ACCOUNT_ID}:alias/terraform-state

secrets:
  provider: aws-secrets
  config:
    secret_name: myapp/terraform-vars
    region: ${AWS_REGION}

auth:
  assume_role:
    role_arn: arn:aws:iam::${AWS_ACCOUNT_ID}:role/TerraformRole
    session_name: terraflow-session
    duration: 3600

variables:
  environment: production
  region: ${AWS_REGION}

workspace_strategy:
  - cli
  - env
  - tag
  - branch
  - hostname

validations:
  require_git_commit: true
  allowed_workspaces:
    - production
    - staging
    - development

logging:
  level: info
  terraform_log: false

